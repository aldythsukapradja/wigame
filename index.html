<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RMO 360 (pilot) — Voidage Balance Simulator</title>
  <style>
    :root{ --bg:#0a0f14; --panel:#0f1720; --ink:#e5f4ee; --muted:#93a3a1; --accent1:#00d68f; --accent2:#1cf5b2; --warn:#ffbe0b; --bad:#ff3b30; --good:#35ff9a; --grid:#11212b; }
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1200px 800px at 70% -10%, rgba(28,245,178,0.15), transparent 60%),radial-gradient(900px 600px at 10% 110%, rgba(0,214,143,0.12), transparent 60%),#0a0f14;color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
    .wrap{max-width:1100px;margin:32px auto;padding:16px}
    header{position:relative;padding:20px;border-radius:20px;background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0));backdrop-filter: blur(6px);border:1px solid rgba(255,255,255,.06)}
    h1{margin:8px 0 0;font-size:28px;letter-spacing:.4px}
    .tagline{color:var(--muted);margin-top:6px}
    .capsule{position:absolute;top:-14px;left:20px;padding:8px 14px;border-radius:999px;font-weight:600;letter-spacing:.3px;font-size:14px;background:linear-gradient(135deg,#0f3d2e,#0b2b22);box-shadow:0 0 0 1px rgba(0,214,143,.2) inset,0 0 20px rgba(28,245,178,.35);text-decoration:none;color:#b6ffe5;transition:transform .18s,box-shadow .18s}
    .capsule:hover{transform:translateY(-1px);box-shadow:0 0 0 1px rgba(28,245,178,.5) inset,0 8px 26px rgba(28,245,178,.45)}

    /* Layout */
    .grid{display:grid;grid-template-columns:1fr;gap:16px;margin-top:16px}
    @media (min-width: 1024px){ .grid{grid-template-columns:minmax(0,1fr) 380px} }

    .card{background:var(--panel);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:16px;position:relative;overflow:hidden}
    .card h2{margin:0 0 12px;font-size:16px;letter-spacing:.4px;color:#ccffee}

    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid rgba(255,255,255,.08);border-radius:999px;font-size:12px;color:#c9fbe9}

    .meters{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .meter{background:#0b131a;border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:10px}
    .meter .label{font-size:12px;color:#a8c7bd;margin-bottom:4px}
    .meter .value{font-weight:700;font-size:18px}

    .health{height:14px;background:#0b131a;border:1px solid rgba(255,255,255,.06);border-radius:999px;overflow:hidden}
    .health>span{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--accent1),var(--accent2));transition:width .2s}

    .gauge{display:flex;align-items:center;gap:8px;font-size:13px}
    .dot{width:10px;height:10px;border-radius:50%}

    canvas{display:block;width:100%;height:300px;background:linear-gradient(0deg,transparent 24px,var(--grid) 25px),linear-gradient(90deg,transparent 24px,var(--grid) 25px);background-size:100% 50px,50px 100%;border-radius:12px;border:1px solid rgba(255,255,255,.06)}

    .controlPads{display:grid;grid-template-columns:1fr;gap:12px}
    .pad{background:#0b131a;border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:12px}
    .padGrid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:8px}
    .bigBtn{appearance:none;border:none;background:#0f1e18;color:#eafff6;padding:18px 0;border-radius:12px;border:1px solid rgba(255,255,255,.08);font-weight:800;letter-spacing:.6px;font-size:22px;cursor:pointer;user-select:none;touch-action:manipulation}

    /* Alarm capsule */
    .alarm{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:linear-gradient(135deg,#3d0f10,#2b0b0d);color:#ffd7d7;border:1px solid rgba(255,59,48,.55);box-shadow:0 0 18px rgba(255,59,48,.35);font-weight:700}
    .alarm .mark{width:18px;height:18px;line-height:18px;border-radius:999px;background:#ff3b30;color:#fff;text-align:center;font-size:12px;font-weight:900}

    /* Mode toggle */
    .modeToggle{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
    .modeToggle .tbtn{padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:#0f1e18;color:#caffef;font-weight:700;cursor:pointer}
    .modeToggle .tbtn.active{box-shadow:0 0 0 1px rgba(28,245,178,.5) inset,0 0 16px rgba(28,245,178,.35);}

    /* Hamburger + mobile header */
    .hamburger{display:none;position:fixed;top:12px;right:12px;z-index:50;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:#0f1720;color:#caffef;font-weight:800}
    @media (max-width:768px){ header{display:none} header.show{display:block} .hamburger{display:block} .wrap{padding-top:54px} }

    /* Scoreboard panel (opens from hamburger) */
    .scoreboard{display:none;position:fixed;top:54px;right:12px;z-index:60;min-width:240px;background:#0f1720;border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:12px;box-shadow:0 12px 30px rgba(0,0,0,.4)}
    .scoreboard.open{display:block}
    .scoreboard h3{margin:0 0 8px;font-size:14px;color:#ccffee}
    .scoreboard .row{display:flex;justify-content:space-between;gap:8px;margin:6px 0}
  
    /* Mobile control dock (always on screen) */
    .mobileDock{display:none}
    @media (max-width:768px){
      .mobileDock{position:fixed;left:0;right:0;bottom:0;z-index:70;background:rgba(15,23,32,.95);backdrop-filter:blur(6px);border-top:1px solid rgba(255,255,255,.08);padding:10px}
      .mobileDock .row{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:10px}
      .mobileDock button{appearance:none;border:none;background:#0f1e18;color:#eafff6;padding:14px 8px;border-radius:12px;border:1px solid rgba(255,255,255,.08);font-weight:800;letter-spacing:.5px;font-size:16px}
    }
  
    /* Capsule buttons (responsive) */
    .cbtn{display:inline-flex;align-items:center;gap:8px;padding:10px 16px;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:linear-gradient(135deg,#0f3d2e,#0b2b22);color:#b6ffe5;font-weight:800;letter-spacing:.3px;cursor:pointer;box-shadow:0 0 0 1px rgba(0,214,143,.15) inset,0 6px 18px rgba(28,245,178,.18)}
    .cbtn:hover{box-shadow:0 0 0 1px rgba(28,245,178,.45) inset,0 10px 28px rgba(28,245,178,.28)}
    .cbtn:active{transform:translateY(1px)}
    .cbtn.ghost{background:#0f1e18;color:#eafff6;border-color:rgba(255,255,255,.1);box-shadow:none}
    @media (max-width:768px){ .cbtn{padding:12px 16px;font-size:15px} }

    /* Make big pad buttons also capsule-like */
    .bigBtn{border-radius:999px}

    /* Ensure overlays don't block clicks */
    #scoreboard{pointer-events:auto}
  </style>
</head>
<body>
  <button id="menuBtn" class="hamburger" aria-label="Toggle header & scoreboard">☰</button>
  <div class="wrap">
    <header>
      <a class="capsule" href="https://aldythsukapradja.github.io/Plan" target="_blank" rel="noopener">Milestones</a>
      <h1>RMO 360 (pilot) — Voidage Balance Simulator</h1>
      <div class="tagline">Keep <strong>VRR</strong> in the sweet spot by adjusting <strong>injection</strong>. Producer fluctuates ±3000 <strong>BOPD</strong> (wider in Challenge). Score climbs while VRR stays in the green band.</div>
    </header>

    <!-- Scoreboard (hamburger) -->
    <div id="scoreboard" class="scoreboard">
      <h3>Scoreboard</h3>
      <div class="row"><span>Best</span><span id="sbBest">0</span></div>
      <div class="row"><span>Last</span><span id="sbLast">0</span></div>
      <div class="row"><span>Runs</span><span id="sbRuns">0</span></div>
    </div>

    <div class="grid">
      <!-- Chart FIRST -->
      <section class="card" id="chartCard">
        <h2>VRR Trend</h2>
        <div class="legend" style="margin-bottom:8px">
          <span><i class="key k-pressure"></i> VRR (%)</span>
          <span><i class="key k-target"></i> Target band</span>
        </div>
        <canvas id="chart" width="800" height="300" aria-label="VRR chart"></canvas>
        <div class="chartFooter" style="display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-top:10px">
          <!-- Single alarm (always visible, fades when OK) -->
          <div id="alarm" class="alarm" style="opacity:.35"><span class="mark">!</span><span id="alarmText">VRR OK (90–110%)</span></div>
          <div class="pill">Target band: <strong id="bandText">90–110 %</strong></div>
          <div class="pill">Fail limits: <strong>80 % / 120 %</strong></div>
        </div>
      </section>

      <!-- Controls SECOND (side-by-side on desktop, below on mobile) -->
      <section class="card" id="controlsCard">
        <h2>Controls</h2>
        <div class="modeToggle">
          <button id="modeTrain" class="tbtn active" aria-pressed="true">Training</button>
          <button id="modeChallenge" class="tbtn" aria-pressed="false">Challenge</button>
        </div>
        <div class="controlPads">
          <div class="pad">
            <div class="row">
              <label>Injector rate</label>
              <div class="pill"><span id="injVal">7000</span> BOPD</div>
            </div>
            <div class="padGrid">
              <button class="bigBtn" id="injUp" aria-label="Increase injector">▲</button>
              <button class="bigBtn" id="injDown" aria-label="Decrease injector">▼</button>
            </div>
            <div class="row" style="margin-top:8px">
              <div class="pill">Producer (variable): <strong id="prodFixedVal">7000</strong> BOPD</div>
            </div>
          </div>
        </div>

        <div class="meters" style="margin:10px 0 6px">
          <div class="meter">
            <div class="label">VRR (Voidage Replacement Ratio)</div>
            <div class="value"><span id="vrrNow">100</span> %</div>
          </div>
          <div class="meter">
            <div class="label">Score</div>
            <div class="value"><span id="score">0</span></div>
          </div>
        </div>

        <!-- Start/Restart buttons -->
        <div class="controls" style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; align-items:center">
          <button id="startBtn" class="cbtn" aria-label="Start simulation">▶ Start</button>
          <button id="restartBtn" class="cbtn ghost" aria-label="Restart simulation">↻ Restart</button>
        </div>

        <div class="gauge" id="gauge">
          <div class="dot" id="gDot" style="background:var(--good)"></div>
          <span id="gText">Stable</span>
        </div>

        <div class="health" style="margin-top:10px"><span id="healthBar"></span></div>

        <div class="status" id="status"></div>
      </section>
    </div>

    <!-- Mobile always-on control dock -->
    <div class="mobileDock" aria-label="Mobile controls">
      <div class="row">
        <button id="mStart" class="cbtn" aria-label="Start">▶ Start</button>
        <button id="mRestart" class="cbtn ghost" aria-label="Restart">↻ Restart</button>
        <button id="mUp" class="cbtn" aria-label="Increase">▲</button>
        <button id="mDown" class="cbtn" aria-label="Decrease">▼</button>
      </div>
    </div>

    <footer>
      Tip: Keep injection near production to hold VRR ~100%. Scoring only while VRR stays in the green band.
    </footer>
  </div>

  <script>
    // ----- Simulation constants -----
    const dt = 0.05; // sim step (s)
    const stepsPerFrame = 1; // update pace

    // VRR setup
    const INJ_MIN = 2500; // BOPD (treated as equivalent control units here)
    const INJ_MAX = 10000; // BOPD
    const PROD_BASE = 7000; // BOPD
    const STEP = 100; // BOPD per tap/interval

    // Mode parameters (training vs challenge)
    let mode = 'training';
    function getProdNoiseBase(){ return mode==='training' ? 50 : 120; } // stronger in challenge
    function getResponseMax(){ return mode==='training' ? 0.14 : 0.26; } // faster in challenge
    function getNoiseAmp(){ return mode==='training' ? 0.6 : 1.2; } // VRR jitter
    let noiseAmp = getNoiseAmp();

    // bands (in % VRR)
    const BAND_MIN = 90, BAND_MAX = 110;
    const FAIL_MIN = 80, FAIL_MAX = 120;

    // ----- State -----
    let inj = 7000; // BOPD (control proxy)
    let prod = PROD_BASE; // BOPD (randomly varies)
    let P = 100; // VRR %
    let score = 0;
    let playing = false; // user must press Start
    let outOfBoundsFor = 0; // seconds out of fail bounds
    let tElapsed = 0; // seconds since start

    // Scoreboard persistence
    let best = Number(localStorage.getItem('vrr_best')||0);
    let runs = Number(localStorage.getItem('vrr_runs')||0);
    let last = Number(localStorage.getItem('vrr_last')||0);

    // UI elements
    const injVal = document.getElementById('injVal');
    const prodFixedValEl = document.getElementById('prodFixedVal');
    const vrrNow = document.getElementById('vrrNow');
    const scoreEl = document.getElementById('score');
    const startBtn = document.getElementById('startBtn');
    const restartBtn = document.getElementById('restartBtn');
    const statusEl = document.getElementById('status');
    const gText = document.getElementById('gText');
    const gDot = document.getElementById('gDot');
    const bandText = document.getElementById('bandText');
    const healthBar = document.getElementById('healthBar');
    const alarmEl = document.getElementById('alarm');
    const alarmText = document.getElementById('alarmText');

    // Hamburger + header + scoreboard
    const menuBtn = document.getElementById('menuBtn');
    const headerEl = document.querySelector('header');
    const sb = document.getElementById('scoreboard');
    const sbBest = document.getElementById('sbBest');
    const sbLast = document.getElementById('sbLast');
    const sbRuns = document.getElementById('sbRuns');

    // Mode buttons
    const modeTrainBtn = document.getElementById('modeTrain');
    const modeChallengeBtn = document.getElementById('modeChallenge');
    // Mobile dock buttons
    const mStart=document.getElementById('mStart'), mRestart=document.getElementById('mRestart'), mUp=document.getElementById('mUp'), mDown=document.getElementById('mDown');

    // Chart
    const canvas = document.getElementById('chart');
    const ctx = canvas.getContext('2d');
    const history = []; const maxPoints = 800;

    function setBadge(msg, type){
      const span = document.createElement('span');
      span.className = `badge ${type||''}`.trim();
      span.textContent = msg; statusEl.prepend(span);
      while(statusEl.children.length>5){ statusEl.removeChild(statusEl.lastChild); }
    }
    function updateScoreboard(){ sbBest.textContent=Math.round(best); sbLast.textContent=Math.round(last); sbRuns.textContent=runs; }
    function clampInj(v){ return Math.max(INJ_MIN, Math.min(INJ_MAX, v)); }

    function updateUI(){
      injVal.textContent = Math.round(inj);
      prodFixedValEl.textContent = Math.round(prod);
      vrrNow.textContent = Math.round(P);
      scoreEl.textContent = Math.round(score);

      let st = 'Stable', col = 'var(--good)';
      if(P < BAND_MIN) { st='Low'; col='var(--warn)'; }
      if(P > BAND_MAX) { st='High'; col='var(--warn)'; }
      if(P < FAIL_MIN || P > FAIL_MAX){ st='Critical'; col='var(--bad)'; }
      gText.textContent = st; gDot.style.background = col; // use CSS var directly

      // health vs 100%
      const norm = Math.max(0, 100 - Math.abs(P - 100));
      healthBar.style.width = Math.max(0, Math.min(100, norm)) + '%';

      // alarm capsule (always visible)
      if(P < FAIL_MIN){
        alarmText.textContent = '⚠ Excessive Gas Production (VRR < 80%)';
        alarmEl.style.opacity = 1;
      } else if(P > FAIL_MAX){
        alarmText.textContent = '⚠ Excessive Water Production (VRR > 120%)';
        alarmEl.style.opacity = 1;
      } else {
        alarmText.textContent = 'VRR OK (90–110%)';
        alarmEl.style.opacity = 0.35; // visible but subdued when safe
      }
    }

    function dynamicBounds(){
      // Training: fixed ±3000 around base (4000..10000)
      if(mode==='training') return {min: Math.max(500, PROD_BASE-3000), max: PROD_BASE+3000};
      // Challenge: widen gradually to extreme (approx 0..2x base) over time
      const widen = Math.min(1, 1 - Math.exp(-tElapsed/45)); // 0 -> 1
      const span = 7000 + 7000*widen; // from 7000 to 14000
      const min = Math.max(500, PROD_BASE - span);
      const max = PROD_BASE + span;
      return {min, max};
    }

    function physicsStep(){
      // time
      tElapsed += dt;

      // producer random walk around base with drift; noise ramps; bounds may widen in challenge
      const prodNoiseBase = (mode==='training'?50:120);
      const effNoise = prodNoiseBase * (1 + 1.2 * (1 - Math.exp(-tElapsed/35)));
      prod += (PROD_BASE - prod) * 0.01 + (Math.random()*2-1) * effNoise;
      const b = dynamicBounds();
      if(prod < b.min) prod = b.min + Math.random()*100;
      if(prod > b.max) prod = b.max - Math.random()*100;

      const desired = (inj / Math.max(200, prod)) * 100; // avoid divide-by-very-small
      const noise = (Math.random()*2-1) * noiseAmp;

      // response gain increases over time (faster as the game goes on), capped by mode
      const responseGain = 0.06 + ((mode==='training'?0.14:0.26) - 0.06) * (1 - Math.exp(-tElapsed/30));
      P += (desired - P) * responseGain + noise * dt * 5;

      if(P >= BAND_MIN && P <= BAND_MAX) score += dt * 8; // scoring

      if(P < FAIL_MIN || P > FAIL_MAX) outOfBoundsFor += dt; else outOfBoundsFor = Math.max(0, outOfBoundsFor - dt*0.5);

      history.push(P); if(history.length > maxPoints) history.shift();
    }

    function drawChart(){
      const w = canvas.width, h = canvas.height; ctx.clearRect(0,0,w,h);
      // target band
      const yMin = mapP(BAND_MAX, h), yMax = mapP(BAND_MIN, h);
      ctx.save(); ctx.globalAlpha = 0.25; ctx.fillStyle = '#00d68f'; ctx.fillRect(0, yMin, w, yMax - yMin); ctx.restore();
      // VRR line
      if(history.length>1){
        ctx.beginPath(); ctx.lineWidth = 2; ctx.strokeStyle = '#9bfdd7';
        for(let i=0;i<history.length;i++){ const x = (i/(maxPoints-1))*w; const y = mapP(history[i], h); if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);} ctx.stroke();
      }
      // current point
      ctx.beginPath(); ctx.fillStyle = '#eafff6'; const x = (history.length-1)/(maxPoints-1)*w; ctx.arc(x, mapP(P,h), 3, 0, Math.PI*2); ctx.fill();
    }

    function mapP(p,h){ const min=50, max=150; return h - (p-min)/(max-min)*h; }

    let raf; function loop(){
      for(let i=0;i<stepsPerFrame;i++) physicsStep();
      updateUI(); drawChart();
      if(outOfBoundsFor > 5){
        // save run
        last = score; runs += 1; if(score > best) best = score;
        localStorage.setItem('vrr_best', best);
        localStorage.setItem('vrr_runs', runs);
        localStorage.setItem('vrr_last', last);
        updateScoreboard();
        setBadge('Game over: VRR stayed critical for >5s','bad');
        cancelAnimationFrame(raf); playing=false; return;
      }
      raf = requestAnimationFrame(loop);
    }

    // Controls
    function changeRate(delta){ inj = clampInj(inj + delta); }
    function bindHold(btn, delta){
      let repeat; const start=()=>{ changeRate(delta); repeat=setInterval(()=>changeRate(delta),150); };
      const stop=()=>{ clearInterval(repeat); };
      btn.addEventListener('mousedown', start);
      btn.addEventListener('touchstart', (e)=>{ e.preventDefault(); start(); }, {passive:false});
      ['mouseup','mouseleave','touchend','touchcancel'].forEach(ev=>btn.addEventListener(ev, stop));
    }
    bindHold(document.getElementById('injUp'), +STEP);
    bindHold(document.getElementById('injDown'), -STEP);
    // mobile dock tap & hold for ▲▼
    bindHold(mUp, +STEP);
    bindHold(mDown, -STEP);

    document.addEventListener('keydown', (e)=>{
      if(!playing) return;
      if(e.key==='ArrowUp' || e.key.toLowerCase()==='w') changeRate(+STEP);
      if(e.key==='ArrowDown' || e.key.toLowerCase()==='s') changeRate(-STEP);
    });

    // Hamburger + modes
    menuBtn.addEventListener('click',()=>{ headerEl.classList.toggle('show'); sb.classList.toggle('open'); updateScoreboard(); });
    function setMode(m){ mode = m; noiseAmp = getNoiseAmp();
      modeTrainBtn.classList.toggle('active', m==='training'); modeTrainBtn.setAttribute('aria-pressed', m==='training');
      modeChallengeBtn.classList.toggle('active', m==='challenge'); modeChallengeBtn.setAttribute('aria-pressed', m==='challenge');
      setBadge('Mode: ' + (m==='training'?'Training':'Challenge'), '');
    }
    modeTrainBtn.addEventListener('click', ()=> setMode('training'));
    modeChallengeBtn.addEventListener('click', ()=> setMode('challenge'));

    // Start/Restart
    startBtn.addEventListener('click', ()=>{ if(playing) return; playing=true; setBadge('Simulation running','good'); raf=requestAnimationFrame(loop); });
    restartBtn.addEventListener('click', ()=>{ cancelAnimationFrame(raf); inj=7000; prod=PROD_BASE; P=100; score=0; outOfBoundsFor=0; tElapsed=0; history.length=0; updateUI(); drawChart(); playing=true; setBadge('Restarted',''); raf=requestAnimationFrame(loop); });
    // Mobile dock duplicates
    mStart.addEventListener('click', ()=>{ if(playing) return; playing=true; setBadge('Simulation running','good'); raf=requestAnimationFrame(loop); });
    mRestart.addEventListener('click', ()=>{ cancelAnimationFrame(raf); inj=7000; prod=PROD_BASE; P=100; score=0; outOfBoundsFor=0; tElapsed=0; history.length=0; updateUI(); drawChart(); playing=true; setBadge('Restarted',''); raf=requestAnimationFrame(loop); });

    // init
    function init(){ bandText.textContent = `${BAND_MIN}–${BAND_MAX} %`; updateScoreboard(); updateUI(); drawChart(); selfTest(); }
    init();

    // --- Smoke tests (non-intrusive) ---
    function runTests(){
      try{
        console.assert(document.getElementById('startBtn'), 'Start button missing');
        console.assert(document.getElementById('restartBtn'), 'Restart button missing');
        // Start should set playing=true
        playing=false; document.getElementById('startBtn').click(); setTimeout(()=>{
          console.assert(playing===true, 'Start did not set playing=true');
          // Increase injection via mousedown (bindHold uses mousedown)
          const before=inj; const ev=new Event('mousedown'); document.getElementById('injUp').dispatchEvent(ev);
          setTimeout(()=>{ ['mouseup','mouseleave'].forEach(t=>document.getElementById('injUp').dispatchEvent(new Event(t))); console.assert(inj>=before, 'Injector ▲ did not increase');
            // Restart resets state
            document.getElementById('restartBtn').click(); setTimeout(()=>{
              console.assert(score===0 && Math.abs(P-100)<1.5, 'Restart did not reset');
              setBadge('Self-test passed','good');
            },120);
          },120);
        },120);
      }catch(e){ setBadge('Self-test failed: '+e.message,'bad'); }
    }
    setTimeout(runTests, 300);
  </script>
</body>
</html>
