<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RMO 360 (pilot) — Voidage Balance Simulator</title>
  <style>
    :root{ --bg:#0a0f14; --panel:#0f1720; --ink:#e5f4ee; --muted:#93a3a1; --accent1:#00d68f; --accent2:#1cf5b2; --warn:#ffbe0b; --bad:#ff3b30; --good:#35ff9a; --grid:#11212b; }
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1200px 800px at 70% -10%, rgba(28,245,178,0.15), transparent 60%),radial-gradient(900px 600px at 10% 110%, rgba(0,214,143,0.12), transparent 60%),#0a0f14;color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
    .wrap{max-width:1100px;margin:32px auto;padding:16px}
    header{position:relative;padding:20px;border-radius:20px;background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0));backdrop-filter: blur(6px);border:1px solid rgba(255,255,255,.06)}
    h1{margin:8px 0 0;font-size:28px;letter-spacing:.4px}
    .tagline{color:var(--muted);margin-top:6px}
    .capsule{position:absolute;top:-14px;left:20px;padding:8px 14px;border-radius:999px;font-weight:600;letter-spacing:.3px;font-size:14px;background:linear-gradient(135deg,#0f3d2e,#0b2b22);box-shadow:0 0 0 1px rgba(0,214,143,.2) inset,0 0 20px rgba(28,245,178,.35);text-decoration:none;color:#b6ffe5;transition:transform .18s,box-shadow .18s}
    .capsule:hover{transform:translateY(-1px);box-shadow:0 0 0 1px rgba(28,245,178,.5) inset,0 8px 26px rgba(28,245,178,.45)}

    .grid{display:grid;grid-template-columns:1fr;gap:16px;margin-top:16px}
    @media (min-width: 1024px){ .grid{grid-template-columns:minmax(0,1fr) 380px} }

    .card{background:var(--panel);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:16px;position:relative;overflow:hidden}
    .card h2{margin:0 0 12px;font-size:16px;letter-spacing:.4px;color:#ccffee}

    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid rgba(255,255,255,.08);border-radius:999px;font-size:12px;color:#c9fbe9}

    .meters{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .meter{background:#0b131a;border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:10px}
    .meter .label{font-size:12px;color:#a8c7bd;margin-bottom:4px}
    .meter .value{font-weight:700;font-size:18px}

    .health{height:14px;background:#0b131a;border:1px solid rgba(255,255,255,.06);border-radius:999px;overflow:hidden}
    .health>span{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--accent1),var(--accent2));transition:width .2s}

    .gauge{display:flex;align-items:center;gap:8px;font-size:13px}
    .dot{width:10px;height:10px;border-radius:50%}

    canvas{display:block;width:100%;height:300px;background:linear-gradient(0deg,transparent 24px,var(--grid) 25px),linear-gradient(90deg,transparent 24px,var(--grid) 25px);background-size:100% 50px,50px 100%;border-radius:12px;border:1px solid rgba(255,255,255,.06)}

    .controlPads{display:grid;grid-template-columns:1fr;gap:12px}
    .pad{background:#0b131a;border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:12px}
    .padGrid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:8px}
    .bigBtn{appearance:none;border:none;background:#0f1e18;color:#eafff6;padding:18px 0;border-radius:12px;border:1px solid rgba(255,255,255,.08);font-weight:800;letter-spacing:.6px;font-size:22px;cursor:pointer;user-select:none;touch-action:manipulation}

    .alarm{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:linear-gradient(135deg,#3d0f10,#2b0b0d);color:#ffd7d7;border:1px solid rgba(255,59,48,.55);box-shadow:0 0 18px rgba(255,59,48,.35);font-weight:700}
    .alarm .mark{width:18px;height:18px;line-height:18px;border-radius:999px;background:#ff3b30;color:#fff;text-align:center;font-size:12px;font-weight:900}

    .modeToggle{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
    .modeToggle .tbtn{padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:#0f1e18;color:#caffef;font-weight:700;cursor:pointer}
    .modeToggle .tbtn.active{box-shadow:0 0 0 1px rgba(28,245,178,.5) inset,0 0 16px rgba(28,245,178,.35);}

    .hamburger{display:none;position:fixed;top:12px;right:12px;z-index:50;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:#0f1720;color:#caffef;font-weight:800}
    @media (max-width:768px){ header{display:none} header.show{display:block} .hamburger{display:block} .wrap{padding-top:54px} }
  </style>
</head>
<body>
  <button id="menuBtn" class="hamburger" aria-label="Toggle header">☰</button>
  <div class="wrap">
    <header>
      <a class="capsule" href="https://aldythsukapradja.github.io/Plan" target="_blank" rel="noopener">Milestones</a>
      <h1>RMO 360 (pilot) — Voidage Balance Simulator</h1>
      <div class="tagline">Keep <strong>VRR</strong> (Voidage Replacement Ratio) in the sweet spot by adjusting <strong>injection</strong>. Producer fluctuates ±3000 <strong>BOPD</strong>. Score climbs while VRR stays in the green band.</div>
    </header>

    <div class="grid">
      <section class="card" id="chartCard">
        <h2>VRR Trend</h2>
        <div class="legend" style="margin-bottom:8px">
          <span><i class="key k-pressure"></i> VRR (%)</span>
          <span><i class="key k-target"></i> Target band</span>
        </div>
        <canvas id="chart" width="800" height="300" aria-label="VRR chart"></canvas>
        <div class="chartFooter" style="display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-top:10px">
          <div id="alarm" class="alarm" style="opacity:.35"><span class="mark">!</span><span id="alarmText">VRR OK (90–110%)</span></div>
          <div class="pill">Target band: <strong id="bandText">90–110 %</strong></div>
          <div class="pill">Fail limits: <strong>80 % / 120 %</strong></div>
        </div>
      </section>

      <section class="card" id="controlsCard">
        <h2>Controls</h2>
        <div class="modeToggle">
          <button id="modeTrain" class="tbtn active" aria-pressed="true">Training</button>
          <button id="modeChallenge" class="tbtn" aria-pressed="false">Challenge</button>
        </div>
        <div class="controlPads">
          <div class="pad">
            <div class="row">
              <label>Injector rate</label>
              <div class="pill"><span id="injVal">7000</span> BOPD</div>
            </div>
            <div class="padGrid">
              <button class="bigBtn" id="injUp" aria-label="Increase injector">▲</button>
              <button class="bigBtn" id="injDown" aria-label="Decrease injector">▼</button>
            </div>
            <div class="row" style="margin-top:8px">
              <div class="pill">Producer (variable): <strong id="prodFixedVal">7000</strong> BOPD</div>
            </div>
          </div>
        </div>

        <div class="meters" style="margin:10px 0 6px">
          <div class="meter">
            <div class="label">VRR (Voidage Replacement Ratio)</div>
            <div class="value"><span id="vrrNow">100</span> %</div>
          </div>
          <div class="meter">
            <div class="label">Score</div>
            <div class="value"><span id="score">0</span></div>
          </div>
        </div>

        <div id="alarm" class="alarm" style="opacity:.35; margin:6px 0 8px 0"><span class="mark">!</span><span id="alarmText">VRR OK (90–110%)</span></div>

        <div class="gauge" id="gauge">
          <div class="dot" id="gDot" style="background:var(--good)"></div>
          <span id="gText">Stable</span>
        </div>

        <div class="health" style="margin-top:10px"><span id="healthBar"></span></div>

        <div class="status" id="status"></div>
      </section>
    </div>

    <footer>
      Tip: Keep injection near production to hold VRR ~100%. Scoring only while VRR stays in the green band.
    </footer>
  </div>

  <script>
    const dt = 0.05; const stepsPerFrame = 1;
    const INJ_MIN = 2500, INJ_MAX = 10000, PROD_BASE = 7000, STEP = 100;
    let mode = 'training';
    function getProdNoiseBase(){ return mode==='training'?50:110; }
    function getResponseMax(){ return mode==='training'?0.14:0.22; }
    function getNoiseAmp(){ return mode==='training'?0.6:1.2; }
    let noiseAmp = getNoiseAmp();
    const BAND_MIN=90,BAND_MAX=110,FAIL_MIN=80,FAIL_MAX=120;

    let inj=7000, prod=PROD_BASE, P=100, score=0, playing=true, outOfBoundsFor=0, tElapsed=0;
    const injVal=document.getElementById('injVal'), prodFixedValEl=document.getElementById('prodFixedVal'), vrrNow=document.getElementById('vrrNow'), scoreEl=document.getElementById('score');
    const statusEl=document.getElementById('status'), gText=document.getElementById('gText'), gDot=document.getElementById('gDot'), bandText=document.getElementById('bandText'), healthBar=document.getElementById('healthBar');
    const alarmEl=document.getElementById('alarm'), alarmText=document.getElementById('alarmText');
    const menuBtn=document.getElementById('menuBtn'), headerEl=document.querySelector('header');
    const modeTrainBtn=document.getElementById('modeTrain'), modeChallengeBtn=document.getElementById('modeChallenge');

    const canvas=document.getElementById('chart'); const ctx=canvas.getContext('2d'); const history=[]; const maxPoints=800;

    function clampInj(v){ return Math.max(INJ_MIN,Math.min(INJ_MAX,v)); }
    function setBadge(msg,type){ const span=document.createElement('span'); span.className=`badge ${type||''}`.trim(); span.textContent=msg; statusEl.prepend(span); while(statusEl.children.length>5){ statusEl.removeChild(statusEl.lastChild);} }

    function updateUI(){ injVal.textContent=Math.round(inj); prodFixedValEl.textContent=Math.round(prod); vrrNow.textContent=Math.round(P); scoreEl.textContent=Math.round(score);
      let st='Stable',col='var(--good)'; if(P<BAND_MIN){st='Low';col='var(--warn)';} if(P>BAND_MAX){st='High';col='var(--warn)';} if(P<FAIL_MIN||P>FAIL_MAX){st='Critical';col='var(--bad)';}
      gText.textContent=st; gDot.style.background=getComputedStyle(document.documentElement).getPropertyValue(col);
      const norm=Math.max(0,100-Math.abs(P-100)); healthBar.style.width=Math.max(0,Math.min(100,norm))+'%';
      if(P<FAIL_MIN){ alarmText.textContent='⚠ Excessive Gas Production (VRR < 80%)'; alarmEl.style.opacity=1; } else if(P>FAIL_MAX){ alarmText.textContent='⚠ Excessive Water Production (VRR > 120%)'; alarmEl.style.opacity=1; } else { alarmText.textContent='VRR OK (90–110%)'; alarmEl.style.opacity=0.35; }
    }

    function physicsStep(){ tElapsed+=dt; const prodNoiseBase=getProdNoiseBase(); const effNoise=prodNoiseBase*(1+1.0*(1-Math.exp(-tElapsed/35))); prod+=(PROD_BASE-prod)*0.01+(Math.random()*2-1)*effNoise; if(prod<PROD_BASE-3000)prod=PROD_BASE-3000+Math.random()*100; if(prod>PROD_BASE+3000)prod=PROD_BASE+3000-Math.random()*100; const desired=(inj/prod)*100; const noise=(Math.random()*2-1)*noiseAmp; const responseGain=0.06+(getResponseMax()-0.06)*(1-Math.exp(-tElapsed/30)); P+=(desired-P)*responseGain+noise*dt*5; if(P>=BAND_MIN&&P<=BAND_MAX)score+=dt*8; if(P<FAIL_MIN||P>FAIL_MAX)outOfBoundsFor+=dt; else outOfBoundsFor=Math.max(0,outOfBoundsFor-dt*0.5); history.push(P); if(history.length>maxPoints)history.shift(); }

    function drawChart(){ const w=canvas.width,h=canvas.height; ctx.clearRect(0,0,w,h); const yMin=mapP(BAND_MAX,h),yMax=mapP(BAND_MIN,h); ctx.save(); ctx.globalAlpha=0.25; ctx.fillStyle='#00d68f'; ctx.fillRect(0,yMin,w,yMax-yMin); ctx.restore(); if(history.length>1){ ctx.beginPath(); ctx.lineWidth=2; ctx.strokeStyle='#9bfdd7'; for(let i=0;i<history.length;i++){ const x=(i/(maxPoints-1))*w; const y=mapP(history[i],h); if(i===0)ctx.moveTo(x,y); else ctx.lineTo(x,y);} ctx.stroke(); } ctx.beginPath(); ctx.fillStyle='#eafff6'; const x=(history.length-1)/(maxPoints-1)*w; ctx.arc(x,mapP(P,h),3,0,Math.PI*2); ctx.fill(); }
    function mapP(p,h){ const min=50,max=150; return h-(p-min)/(max-min)*h; }

    let raf; function loop(){ for(let i=0;i<stepsPerFrame;i++)physicsStep(); updateUI(); drawChart(); if(outOfBoundsFor>5){ setBadge('Game over: VRR stayed critical for >5s','bad'); inj=7000;prod=PROD_BASE;P=100;score=0;
